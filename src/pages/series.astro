---
import BaseLayout from "@layouts/BaseLayout.astro";
import SeriesList from "@layouts/SeriesList.astro";
import { getCollection, getEntry } from "astro:content";
const allPosts = await getCollection("series");
const categories = [
  ...new Set(allPosts.map((post) => post.data.category).flat()),
];
const posts = [];

categories.forEach((category) => {
  let filteredPosts = allPosts.filter(
    (post) => post.data.category === category
  );
  posts.push(filteredPosts);
});
---

<BaseLayout primaryTitle="Series">
  <section class="archive">
    <div class="section-content section-tag">
      {
        categories.map((tag, index) => {
          return (
            <div class="archive-tag">
              <h2 class="tag-header">{tag}</h2>
              <div class="tag-post-list">
                {posts[index].length !== 0 ? (
                  <SeriesList posts={posts[index]} />
                ) : (
                  <div class="no-posts">No posts for now.</div>
                )}
              </div>
            </div>
          );
        })
      }
    </div>
  </section>
</BaseLayout>
